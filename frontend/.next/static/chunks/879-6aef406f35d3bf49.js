"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{4362:function(e,t,a){a.d(t,{AuthProvider:function(){return c},a:function(){return l}});var r=a(7437),n=a(2265),o=a(1837),i=a(9064);let s=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[a,c]=(0,n.useState)(null),[l,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{let a=JSON.parse(t);c({...a,token:e})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}u(!1)},[]);let d=async e=>{try{u(!0);let t=await o.iJ.login(e),a={...t.user,token:t.token};c(a),localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),i.ZP.success("Login successful!")}catch(e){var t,a;throw i.ZP.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Login failed"),e}finally{u(!1)}},f=async e=>{try{u(!0),await o.iJ.register(e),i.ZP.success("Registration successful! Please login.")}catch(e){var t,a;throw i.ZP.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Registration failed"),e}finally{u(!1)}};return(0,r.jsx)(s.Provider,{value:{user:a,loading:l,login:d,register:f,logout:()=>{c(null),localStorage.removeItem("token"),localStorage.removeItem("user"),i.ZP.success("Logged out successfully")},isAuthenticated:!!a,hasRole:e=>!!a&&e.includes(a.role)},children:t})}function l(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9879:function(e,t,a){a.d(t,{NotificationProvider:function(){return g},z:function(){return m}});var r=a(7437),n=a(2265),o=a(1837),i=a(4362),s=a(9064),c=a(257),l=a(5302),u=a(3327),d=a(2252),f=a(3245);let p=(0,n.createContext)(void 0);function g(e){let{children:t}=e,{user:a,isAuthenticated:g}=(0,i.a)(),[m,w]=(0,n.useState)([]),[h,y]=(0,n.useState)(0),{isConnected:v,connectionError:k}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{user:t,isAuthenticated:a}=(0,i.a)(),{onNotification:r,autoConnect:o=!0}=e,[l,u]=(0,n.useState)(!1),[d,f]=(0,n.useState)(null),p=(0,n.useRef)(null),g=(0,n.useRef)(null),m=(0,n.useRef)(0),w=()=>{var e;if(a&&t&&(null===(e=p.current)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN)try{let e=c.env.NEXT_PUBLIC_WS_URL||"ws://127.0.0.1:8787",a=localStorage.getItem("token");if(!a){f("No authentication token available");return}let n=new WebSocket("".concat(e,"/api/notifications/ws?token=").concat(a,"&userId=").concat(t.id));p.current=n,n.onopen=()=>{console.log("WebSocket connected for real-time notifications"),u(!0),f(null),m.current=0,n.send(JSON.stringify({type:"ping",userId:t.id,timestamp:Date.now()}))},n.onmessage=e=>{try{let t=JSON.parse(e.data);switch(t.type){case"notification":let a=t.notification;r&&r(a),v(a);break;case"pong":console.log("WebSocket pong received");break;case"error":console.error("WebSocket error message:",t.message),f(t.message);break;default:console.log("Unknown WebSocket message type:",t.type)}}catch(e){console.error("Failed to parse WebSocket message:",e)}},n.onclose=e=>{if(console.log("WebSocket disconnected:",e.code,e.reason),u(!1),p.current=null,1e3!==e.code&&m.current<5){let e=Math.min(1e3*Math.pow(2,m.current),3e4);console.log("Attempting to reconnect in ".concat(e,"ms (attempt ").concat(m.current+1,")")),g.current=setTimeout(()=>{m.current++,w()},e)}else m.current>=5&&f("Failed to reconnect after multiple attempts")},n.onerror=e=>{console.error("WebSocket error:",e),f("Connection error occurred")}}catch(e){console.error("Failed to connect to WebSocket:",e),f("Failed to establish connection")}},h=()=>{g.current&&(clearTimeout(g.current),g.current=null),p.current&&(p.current.close(1e3,"User disconnected"),p.current=null),u(!1),f(null),m.current=0},y=()=>{var e;(null===(e=p.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&t&&p.current.send(JSON.stringify({type:"ping",userId:t.id,timestamp:Date.now()}))};(0,n.useEffect)(()=>(o&&a&&t&&w(),()=>{h()}),[a,t,o]),(0,n.useEffect)(()=>{if(!l)return;let e=setInterval(y,3e4);return()=>clearInterval(e)},[l,t]);let v=e=>{var t;let a=(t=e.type,"urgent"===e.priority?"error":"certificate"===t&&e.message.includes("approved")?"success":"certificate"===t&&e.message.includes("rejected")?"error":"points"===t?"success":"system"===t?"error":"default"),r="".concat(e.title,"\n").concat(e.message).concat("urgent"===e.priority?" (URGENT)":"");switch(a){case"success":s.ZP.success(r,{duration:5e3});break;case"error":s.ZP.error(r,{duration:7e3});break;default:(0,s.ZP)(r,{duration:4e3})}"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission(),"urgent"===e.priority&&"Notification"in window&&"granted"===Notification.permission&&new Notification(e.title,{body:e.message,icon:"/favicon.ico",tag:"notification-".concat(e.id)})};return{isConnected:l,connectionError:d,connect:w,disconnect:h,sendPing:y}}({onNotification:e=>{w(t=>[e,...t])},autoConnect:!0});(0,n.useEffect)(()=>{if(!g||!a)return;let e=async()=>{try{let e=(await o.BT.getNotifications(a.id)).notifications;h>0&&e.filter(e=>new Date(e.created_at).getTime()>h).forEach(e=>{S(e)}),w(e),y(Date.now())}catch(e){console.error("Failed to fetch notifications:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[g,a,h]);let S=e=>{let t=(t=>{switch(t){case"certificate":return e.message.includes("approved")?"success":e.message.includes("rejected")?"error":"default";case"points":return"success";case"system":return"error";default:return"default"}})(e.type),a=(e=>{switch(e){case"certificate":return(0,r.jsx)(l.Z,{className:"w-5 h-5"});case"points":return(0,r.jsx)(u.Z,{className:"w-5 h-5"});case"system":return(0,r.jsx)(d.Z,{className:"w-5 h-5"});default:return(0,r.jsx)(f.Z,{className:"w-5 h-5"})}})(e.type),n=(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:a}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.message})]})]});"success"===t?s.ZP.success(n):"error"===t?s.ZP.error(n):(0,s.ZP)(n)},N=async e=>{try{await o.BT.markAsRead(e),w(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t))}catch(e){console.error("Failed to mark notification as read:",e)}},P=async()=>{if(a)try{await o.BT.markAllAsRead(a.id),w(e=>e.map(e=>({...e,is_read:!0})))}catch(e){console.error("Failed to mark all notifications as read:",e)}},b=async()=>{if(a)try{let e=await o.BT.getNotifications(a.id);w(e.notifications)}catch(e){console.error("Failed to refresh notifications:",e)}},I=m.filter(e=>!e.is_read).length;return(0,r.jsx)(p.Provider,{value:{notifications:m,unreadCount:I,markAsRead:N,markAllAsRead:P,refreshNotifications:b,isConnected:v,connectionError:k},children:t})}function m(){let e=(0,n.useContext)(p);if(void 0===e)throw Error("useNotifications must be used within a NotificationProvider");return e}},1837:function(e,t,a){a.d(t,{Aw:function(){return s},BT:function(){return l},Hc:function(){return o},Wp:function(){return c},iJ:function(){return n},vd:function(){return i}});let r=a(3464).Z.create({baseURL:"http://127.0.0.1:8787",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),r.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/auth/login"),Promise.reject(e)});let n={login:async e=>(await r.post("/auth/login",e)).data,register:async e=>(await r.post("/auth/register",e)).data},o={uploadCertificate:async e=>{let t=new FormData;return t.append("file",e.file),(await r.post("/certificates/upload?user_id=".concat(e.user_id,"&title=").concat(encodeURIComponent(e.title),"&issued_date=").concat(e.issued_date),t,{headers:{"Content-Type":"application/pdf"}})).data},getUserCertificates:async e=>(await r.get("/users/".concat(e,"/certificates"))).data,downloadCertificate:async e=>(await r.get("/certificates/".concat(e,"/download"),{responseType:"blob"})).data,deleteCertificate:async e=>(await r.delete("/certificates/".concat(e))).data,reviewCertificate:async(e,t,a)=>(await r.put("/certificates/".concat(e,"/review"),{status:t,rejection_reason:a})).data},i={getEvents:async()=>({events:(await r.get("/api/events")).data}),createEvent:async e=>{let t=await r.post("/api/faculty/events",e);return{event:{...e,id:t.data.eventId}}}},s={getWorkshops:async()=>{try{return{workshops:(await r.get("/api/workshops")).data}}catch(e){return{workshops:[]}}},createWorkshop:async(e,t)=>{let a=await r.post("/api/faculty/workshops?eventId=".concat(e),t);return{workshop:{...t,id:a.data.workshopId,event_id:e}}}},c={getUserPoints:async e=>{let t=await r.get("/api/analytics/user?userId=".concat(e));return{total_points:t.data.data.totalPoints,entries:t.data.data.pointsHistory}},addPoints:async(e,t,a)=>(await r.post("/api/admin/award-points",{userId:e,points:t,reason:a})).data},l={getNotifications:async e=>(await r.get("/api/notifications/".concat(e))).data,markAsRead:async e=>(await r.put("/api/notifications/".concat(e,"/read"))).data,markAllAsRead:async e=>(await r.put("/api/notifications/".concat(e,"/read-all"))).data,getPreferences:async e=>(await r.get("/api/notifications/".concat(e,"/preferences"))).data,updatePreferences:async(e,t)=>(await r.put("/api/notifications/".concat(e,"/preferences"),t)).data}}}]);